#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <crypto/aes.h>

i32 main()
{
    AES ctx;

    u8 key[] = { 0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c };
    u8 iv[] = { 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F };
    u8 plain[] = { 0x6b, 0xc1, 0xbe, 0xe2, 0x2e, 0x40, 0x9f, 0x96, 0xe9, 0x3d, 0x7e, 0x11, 0x73, 0x93, 0x17, 0x2a };
    u8 cipher[] = { 0x76, 0x49, 0xab, 0xac, 0x81, 0x19, 0xb2, 0x46, 0xce, 0xe9, 0x8e, 0x9b, 0x12, 0xe9, 0x19, 0x7d };

    aes_init_with_iv(&ctx, iv, key, 16);

    u8 output[16];
    aes_cbc_encode(output, plain, &ctx);

    for (i32 i = 0; i < 16; i++) {
        if (cipher[i] != output[i]) {
            printf("algorithm not working properly, sorry\n");
            aes_free(&ctx);
            exit(1);
        }
    }

    aes_free(&ctx);

    return 0;
}